{% extends "base.html" %}

{% block content %}
<div class="page-header">
  <h1>Upcoming Events</h1>
</div>

{# ── Filters ── #}
<aside class="filters" id="filters">
  <div class="filter-group">
    <span class="filter-label">Time of day</span>
    <div class="filter-options">
      <label class="filter-chip">
        <input type="checkbox" name="timeofday" value="evening" checked>
        <span>Evening</span>
      </label>
      <label class="filter-chip">
        <input type="checkbox" name="timeofday" value="daytime" checked>
        <span>Daytime</span>
      </label>
    </div>
  </div>

  <div class="filter-group">
    <span class="filter-label">Availability</span>
    <label class="filter-chip">
      <input type="checkbox" name="hideSoldOut" id="hideSoldOut" checked>
      <span>Hide sold out</span>
    </label>
  </div>

  <div class="filter-group filter-group--venues">
    <span class="filter-label">Venue</span>
    <div class="filter-options filter-options--wrap" id="venue-filters">
      <label class="filter-chip filter-chip--select-all">
        <input type="checkbox" id="venueSelectAll" checked>
        <span>All venues</span>
      </label>
      {% for v in venue_list %}
      <label class="filter-chip">
        <input type="checkbox" name="venue" value="{{ v.key }}">
        <span>{{ v.name }}</span>
      </label>
      {% endfor %}
    </div>
  </div>
</aside>

{# ── Calendar (desktop) + Agenda (mobile) ── #}
<div class="calendar-container" id="calendar">
  {% for month in months %}
  <section class="month" data-month="{{ month.year }}-{{ '%02d' % month.month }}">
    <h2 class="month-title">{{ month.name }}</h2>
    <div class="cal-grid">
      <div class="cal-dow">Mon</div>
      <div class="cal-dow">Tue</div>
      <div class="cal-dow">Wed</div>
      <div class="cal-dow">Thu</div>
      <div class="cal-dow">Fri</div>
      <div class="cal-dow">Sat</div>
      <div class="cal-dow">Sun</div>

      {% for week in month.weeks %}
        {% for day in week %}
          {% if day == 0 %}
          <div class="cal-day cal-day--empty"></div>
          {% else %}
            {% set day_str = "%s-%02d-%02d" % (month.year, month.month, day) %}
          <div class="cal-day" data-date="{{ day_str }}"
               {% if day_str == today %}data-today{% endif %}>
            <span class="cal-day-num">{{ day }}</span>
            <div class="cal-events" data-date="{{ day_str }}"></div>
          </div>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </section>
  {% endfor %}
</div>

<div class="agenda" id="agenda"></div>

<p class="empty-msg" id="empty-msg" style="display:none">No events match your filters.</p>

{# Embed event data for JS #}
<script>
  window.EVENTS = {{ events_json | safe }};
  window.TODAY = "{{ today }}";
</script>
{% endblock %}

{% block scripts %}
<script src="static/js/calendar.js"></script>
{% endblock %}
